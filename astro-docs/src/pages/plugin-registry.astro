---
import { getCollection } from 'astro:content';
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import { CardGrid, Card, Icon, Badge } from '@astrojs/starlight/components';
import {largeNumberFormatter, dateFormatter } from '../utils/formatters';

const communityPlugins = await getCollection('community-plugins');
const plugins = await getCollection('plugin-docs', (entry) => entry.data.docType === 'overview');
---

<StarlightPage frontmatter={{
  title: 'Nx Plugins',
  description: 'Discover all available Nx plugins to enhance your development workflow. Each plugin provides generators, executors, and migrations to help you build modern applications.',
  tableOfContents: false
}}
>
  <style>
    /* Remove background and border from GitHub icon */
    .plugin-grid .card [data-icon="github"] {
      background: transparent !important;
      border: none !important;
      padding: 0 !important;
    }
  </style>
  <CardGrid class="plugin-grid">
    {plugins.map(plugin => (
      <a href={`/docs/${plugin.data.slug}`} class="no-underline hover:no-underline block h-full">
        <Card title={plugin.data.packageName} icon="github" class="h-full flex flex-col">
          <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-3 mb-4">
            {plugin.data.description}
          </p>
          
          <div class="mt-auto pt-2 border-t border-gray-200 dark:border-gray-800">
            <div class="flex items-center gap-4 text-xs text-gray-500 dark:text-gray-500">
              {plugin.data.lastPublishedDate && (
                <div class="flex items-center gap-1">
                  <Icon name="seti:clock" class="w-3.5 h-3.5" />
                  <span>{dateFormatter(plugin.data.lastPublishedDate!)}</span>
                </div>
              )}
              
              <div class="flex items-center gap-1">
                <Icon name="star" class="w-3.5 h-3.5" />
                <span>{largeNumberFormatter(plugin.data.githubStars!)}</span>
              </div>
              
              <div class="flex items-center gap-1">
                <Icon name="cloud-download" class="w-3.5 h-3.5" />
                <span>{largeNumberFormatter(plugin.data.npmDownloads!)}</span>
              </div>
              
              <div class="ml-auto">
                <Badge size="small" variant="success" text="Nx Open Source" />
              </div>
            </div>
          </div>
        </Card>
      </a>
    ))}
    {communityPlugins.map(plugin => (
      <a href={plugin.data.url} class="no-underline hover:no-underline block h-full" target="_blank" rel="noopener noreferrer">
        <Card title={plugin.id} icon="github" class="h-full flex flex-col">
          <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-3 mb-4">
            {plugin.data.description}
          </p>
          
          <div class="mt-auto pt-2 border-t border-gray-200 dark:border-gray-800">
            <div class="flex items-center gap-4 text-xs text-gray-500 dark:text-gray-500">
              {plugin.data.lastPublishedDate && (
                <div class="flex items-center gap-1">
                  <Icon name="seti:clock" class="w-3.5 h-3.5" />
                  <span>{dateFormatter(plugin.data.lastPublishedDate!)}</span>
                </div>
              )}
              
              <div class="flex items-center gap-1">
                <Icon name="star" class="w-3.5 h-3.5" />
                <span>{plugin.data.githubStars}</span>
              </div>
              
              <div class="flex items-center gap-1">
                <Icon name="cloud-download" class="w-3.5 h-3.5" />
                <span>{plugin.data.npmDownloads}</span>
              </div>
              
              {plugin.data.nxVersion && (
                <div class="ml-auto">
                  <Badge size="small" variant="caution" text={`Nx ${plugin.data.nxVersion}`} />
                </div>
              )}
            </div>
          </div>
        </Card>
      </a>
    ))}
  </CardGrid>


</StarlightPage>
