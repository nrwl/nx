{
  "name": "astro-docs",
  "$schema": "../node_modules/nx/schemas/project-schema.json",
  "comment": "package.json#scripts runs in the project root directory with astro assumes is where the node_modules is. which fails. so run the scripts in project.json#targets with --root command instead",
  "targets": {
    "prebuild-banner": {
      "cache": false,
      "outputs": ["{projectRoot}/src/content/banner.json"],
      "command": "node ../scripts/documentation/prebuild-banner.mjs",
      "options": {
        "cwd": "astro-docs",
        "env": {
          "BANNER_OUTPUT_PATH": "src/content/banner.json",
          "BANNER_ENV_VAR": "BANNER_URL"
        }
      }
    },
    "serve": {
      "continuous": true,
      "dependsOn": [
        "prebuild-banner",
        {
          "projects": ["devkit", "create-nx-workspace", "dotnet", "maven"],
          "target": "build"
        }
      ],
      "command": "astro dev",
      "options": {
        "cwd": "astro-docs"
      }
    },
    "build": {
      "dependsOn": [
        "prebuild-banner",
        {
          "projects": ["devkit", "create-nx-workspace", "dotnet", "maven"],
          "target": "build"
        }
      ],
      "inputs": [
        "production",
        "^production",
        "{projectRoot}/src/content/banner.json",
        { "env": "NX_DEV_URL" }
      ],
      "outputs": [
        "{projectRoot}/dist",
        "{projectRoot}/.astro",
        "{projectRoot}/.netlify"
      ],
      "command": "astro build",
      "options": {
        "cwd": "astro-docs"
      }
    },
    "preview": {
      "dependsOn": ["build"],
      "command": "astro preview",
      "continuous": true,
      "options": {
        "cwd": "astro-docs"
      }
    },
    "astro": {
      "command": "astro",
      "options": {
        "cwd": "astro-docs"
      }
    },
    "test": {
      "executor": "nx:noop",
      "dependsOn": ["vite:test", "validate-links", "format"]
    },
    "pw-e2e": {
      "dependsOn": ["serve"],
      "parallelism": true
    },
    "e2e-ci--**/*": {
      "dependsOn": ["preview"],
      "parallelism": true,
      "options": {
        "args": []
      }
    },
    "show-report": {
      "command": "playwright show-report dist/astro-docs/playwright-report"
    },
    "validate-links": {
      "dependsOn": ["build"],
      "cache": true,
      "inputs": [
        "{projectRoot}/src/**/*",
        "{projectRoot}/astro.config.mjs",
        "{projectRoot}/sidebar.mts",
        "{projectRoot}/markdoc.config.mjs",
        "{projectRoot}/tsconfig.json",
        "{projectRoot}/package.json"
      ],
      "command": "tsx validate-links.ts",
      "options": {
        "cwd": "astro-docs"
      }
    },
    "format": {
      "cache": true,
      "//": "nx format doesn't respect overrides, so we manually run prettier for mdoc files",
      "command": "prettier **/*.mdoc --check"
    },
    "format:write": {
      "command": "prettier **/*.mdoc --write"
    }
  }
}
