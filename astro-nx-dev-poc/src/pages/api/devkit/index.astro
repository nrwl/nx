---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import type { MarkdownHeading } from 'astro';
import { render, getCollection } from 'astro:content';

const devkitDocs = await getCollection('devkit-docs');

if (!devkitDocs) {
  throw new Error('DevKit documentation not found');
}

const byCategory = devkitDocs.reduce((acc, doc) => {
  const category = doc.data.category || 'Uncategorized';
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(doc);
  return acc;
}, {});

const headings: MarkdownHeading[] = Object.keys(byCategory).map((category) => ({
  depth: 2,
  text: category,
  slug: category.toLowerCase().replace(/\s+/g, '-'),
}));
---

<StarlightPage
  frontmatter={{
    title: 'DevKit Documentation',
    description: 'Documentation for the DevKit',
    headings: headings || [],
  }}
>
  {
    Object.entries(byCategory).map(([category, docs]) => (
      <section>
        <h2>{category}</h2>
        <ul>
          {docs.map((doc) => {
            return (
              <li>
                <a
                  href={
                    '/api/devkit/' +
                    category +
                    '#' +
                    doc.data.title.toLowerCase()
                  }
                >
                  {doc.data.title}
                </a>
              </li>
            );
          })}
        </ul>
      </section>
    ))
  }
</StarlightPage>
