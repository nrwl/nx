distribute-on:
  default: 8 linux-large, 1 linux-extra-large
assignment-rules:
  # e2e-release tests must run sequentially due to shared git state and publishing operations
  - projects:
      - e2e-release
    targets:
      - e2e-ci**
    run-on:
      - agent: linux-large
        parallelism: 1

  - projects:
      - e2e-gradle
    targets:
      - e2e-ci**
    run-on:
      - agent: linux-large
        parallelism: 1
      - agent: linux-extra-large
        parallelism: 1

  - projects:
      - e2e-angular
      - e2e-react
      - e2e-next
      - e2e-web
      - e2e-eslint
      - e2e-remix
      - e2e-cypress
      - e2e-docker
      - e2e-js
      - e2e-nx-init
      - nx-maven-plugin
    targets:
      - e2e-ci**react-package**
      - e2e-ci**react.test**
      - e2e-ci**react-router-ts-solution**
      - e2e-ci**next-e2e-and-snapshots**
      - e2e-ci**next-generation**
      - e2e-ci**next-storybook**
      - e2e-ci**next-styles**
      - e2e-ci**next-ts-solutions**
      - e2e-ci**next-webpack**
      - e2e-ci**web**
      - e2e-ci**remix-ts-solution**
      - e2e-ci**linter**
      - e2e-ci**module-federation/misc-rspack-interoperability**
      - e2e-ci**module-federation/dynamic-federation.webpack**
      - e2e-ci**docker**
      - e2e-ci**cypress-legacy**
      - e2e-ci**nx-init-angular**
      - e2e-ci**nx-remix**
      - e2e-ci**cypress**
      - e2e-ci**src/cypress-component-tests-buildable.test**
      - e2e-ci**src/cypress-component-tests-implicit-dep.test**
      - e2e-ci**src/cypress-component-tests-app.test**
      - e2e-ci**src/module-federation-ssr.test**
      - e2e-ci**src/module-federation-lib.test**
      - e2e-ci**nx-init-angular.test**
      - install
      - e2e-ci**src/js-executor-swc.test**
      - e2e-ci**src/js-executor-tsc.test**
      - e2e-ci**src/js-packaging.test**
    run-on:
      - agent: linux-large
        parallelism: 1
      - agent: linux-extra-large
        parallelism: 1

  # All other e2e tests can run in parallel
  - targets:
      - e2e-ci**
    run-on:
      - agent: linux-large
        parallelism: 2
      - agent: linux-extra-large
        parallelism: 3

  # These projects should not need to be isolated.
  - projects:
      - nx-dev
    targets:
      - build*
    run-on:
      - agent: linux-extra-large
        parallelism: 1
  - projects:
      - angular
      - nx
      - react
      - remix
      - workspace
    targets:
      - test
    run-on:
      - agent: linux-extra-large
        parallelism: 1

  - targets:
      - lint
    run-on:
      - agent: linux-large
        parallelism: 6

  - targets:
      - "*"
    run-on:
      - agent: linux-large
        parallelism: 3
      - agent: linux-extra-large
        parallelism: 3
